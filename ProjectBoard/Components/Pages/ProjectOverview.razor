@page "/ProjectOverview/{ProjectId}"
@using ProjectBoard.Model
@using ProjectBoard.Components.SubComponents
@inject IDialogService DialogService

@inject Projects _projects
@* @inject Steps _steps *@

<PageTitle>Projects</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge">


    <MudPaper Height="75px" Width="100%" Square="true">
        <MudButton Size="@Size.Small" OnClick="@CreateNewStep" Variant="@Variant.Filled" Color="@Color.Primary">New step</MudButton>
    </MudPaper>

    <MudPaper Height="75px" Width="100%" Square="true">
        <MudGrid>
            <MudItem xs="3">
                <MudTextField ReadOnly="true" @bind-Value="project.Name" Label="Name" />
            </MudItem>
            <MudItem xs="3">
                <MudTextField ReadOnly="true" @bind-Value="project.Customer" Label="Customer" />
            </MudItem>
        </MudGrid>
    </MudPaper>
    <MudDivider />
    <MudPaper Height="200px" Width="100%" Square="true">
        <MudGrid>
            <MudItem xs="3">
                <MudTextField ReadOnly="true" @bind-Value="project.Description" Label="Description" Lines="4" />
            </MudItem>
            <MudItem xs="3">
                <MudTextField ReadOnly="true" @bind-Value="project.DueDate" Label="DueDate" />
                <MudTextField ReadOnly="true" @bind-Value="project.Priority" Label="Priority" />
            </MudItem>
        </MudGrid>
    </MudPaper>

    <MudPaper>
        <MudDataGrid Items="@project.StepList" Filterable="false" SortMode="@SortMode.None" Groupable="false">
            <Columns>
                <PropertyColumn Property="x => x.Position" />
                <PropertyColumn Property="x => x.Name" />
                <PropertyColumn Property="x => x.Description" />
                <PropertyColumn Property="x => x.DueDate" Title="Due date" />
                <PropertyColumn Property="x => x.IsCompleted" Title="Creation date" />
                <TemplateColumn CellClass="d-flex justify-end">
                    <CellTemplate>
                        <MudStack Row>
                            @* <MudButton Size="@Size.Small" OnClick="@GoToDetail" Variant="@Variant.Filled" Color="@Color.Primary" href="@($"/ProjectOverview/{context.Item.Id}")">Detail</MudButton> *@
                        </MudStack>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>
    </MudPaper>
</MudContainer>
@code {

    [Parameter]
    public string ProjectId { get; set; }

    private Project? project;
    private int currentCount = 0;

    protected override async Task OnInitializedAsync()
    {
        project = await _projects.GetProjectById(Convert.ToInt32(ProjectId));
    }

    private async Task CreateNewStep()
    {
        var parameters = new DialogParameters<CreateStep>
        {
            { x => x.projectId, Convert.ToInt32(ProjectId)},
        };

        //var options = new DialogOptions() { CloseButton = true, MaxWidth = MaxWidth.ExtraSmall };

        var options = new DialogOptions { CloseOnEscapeKey = false, BackdropClick = false, CloseButton = true };

        var dialog = await DialogService.ShowAsync<CreateStep>("Create new step", parameters, options);
        var result = await dialog.Result;

        // if (!result.Canceled)
        // {
        //     project = await _projects.GetAllProjects();
        // }
    }

    // private async void GoToDetail()
    // {

    //         project.Add(new Project
    //         {
    //             Name = "TEST"
    //         });

    // }
}
